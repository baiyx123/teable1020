# 🔧 边框显示问题修复

## 🐛 问题分析

### 原始问题
- 红色边框只显示在单元格的顶部或底部
- 第一行的顶部边框显示不出来
- 边框不完整，只有部分边框可见

### 根本原因
裁剪区域设置问题：
```typescript
// 原来的裁剪区域
y: rowInitSize + 1  // 从表头下方1像素开始裁剪
height: containerHeight - rowInitSize - 1

// 问题：第一行数据单元格的顶部边框被裁剪掉了
```

### 坐标系统分析
- `rowInitSize`: 表头高度
- 单元格坐标: `coordInstance.getRowOffset(rowIndex) - scrollTop`
- 第一行数据单元格的 `y` 坐标接近 `rowInitSize`
- 裁剪区域从 `rowInitSize + 1` 开始，导致顶部边框被裁剪

## ✅ 修复方案

### 调整裁剪区域
```typescript
// 修复后的裁剪区域
y: rowInitSize  // 从表头底部开始裁剪
height: containerHeight - rowInitSize

// 这样第一行数据单元格的边框就能完整显示
```

### 修改的文件
- `packages/sdk/src/components/grid/renderers/layout-renderer/layoutRenderer.ts`
- 修改了4个 `drawClipRegion` 调用

## 🧪 测试步骤

### 1. 触发错误状态
```bash
# 方法1：网络断开
1. 开发者工具 → Network → Offline
2. 编辑任意单元格
3. 观察红色边框

# 方法2：服务器错误（已配置20%概率）
1. 编辑单元格
2. 观察是否触发错误
```

### 2. 验证边框完整性
```
✅ 第一行数据单元格的顶部边框应该显示
✅ 所有单元格的四个边框都应该显示
✅ 边框颜色应该是红色（错误状态）
✅ 边框应该一直保留，直到重新编辑
```

### 3. 验证不同位置
```
- 第一行数据单元格
- 中间行数据单元格  
- 最后一行数据单元格
- 冻结列和非冻结列
```

## 🎯 预期结果

### 修复前
```
[表头]
[第一行] ← 顶部边框被裁剪，看不到
[第二行] ← 只有底部边框可见
[第三行] ← 只有底部边框可见
```

### 修复后
```
[表头]
[第一行] ← 完整边框可见 ✅
[第二行] ← 完整边框可见 ✅
[第三行] ← 完整边框可见 ✅
```

## 🔍 技术细节

### 裁剪区域对比
```typescript
// 修复前
{
  x: 0,
  y: rowInitSize + 1,        // 问题：+1 导致第一行边框被裁剪
  width: freezeRegionWidth + 1,
  height: containerHeight - rowInitSize - 1,  // 问题：-1 导致底部边框被裁剪
}

// 修复后  
{
  x: 0,
  y: rowInitSize,            // 修复：从表头底部开始
  width: freezeRegionWidth + 1,
  height: containerHeight - rowInitSize,      // 修复：包含所有数据行
}
```

### 影响的区域
1. **冻结区域** (Freeze Region)
2. **其他区域** (Other Region)  
3. **缓存区域** (Cache Region) - 两个缓存区域

## 🚀 测试命令

```bash
# 1. 确保开发服务器运行
cd /home/baiyx/teable1020/apps/nestjs-backend
pnpm dev

# 2. 访问应用
# http://localhost:3000

# 3. 测试边框显示
# 编辑单元格触发错误状态，观察边框是否完整显示
```

## 📝 验收标准

- [ ] 第一行数据单元格的顶部边框可见
- [ ] 所有单元格的四个边框都完整显示
- [ ] 边框颜色正确（红色表示错误）
- [ ] 边框一直保留直到重新编辑
- [ ] 不影响其他UI元素显示
- [ ] 性能无影响

## 🎉 修复完成

现在红色边框应该能够完整显示在所有单元格上，包括第一行数据单元格的顶部边框！
