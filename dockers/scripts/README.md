# Docker æ„å»ºå’Œéƒ¨ç½²è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äºæ„å»ºå’Œéƒ¨ç½² Teable Docker é•œåƒçš„å·¥å…·è„šæœ¬ã€‚

## ğŸ“‹ è„šæœ¬è¯´æ˜

### setup-docker-mirror.sh â­ ä¼˜å…ˆæ‰§è¡Œ
**ç”¨é€”**: é…ç½® Docker é•œåƒåŠ é€Ÿå™¨

**é‡è¦æ€§**: â­â­â­â­â­ å¿…é¡»é¦–å…ˆé…ç½®ï¼

**åŠŸèƒ½**:
- è‡ªåŠ¨é…ç½® Docker é•œåƒåŠ é€Ÿå™¨
- ä½¿ç”¨å›½å†…é•œåƒæºï¼ˆä¸­ç§‘å¤§ã€DaoCloudã€è…¾è®¯äº‘ç­‰ï¼‰
- è‡ªåŠ¨å¤‡ä»½åŸæœ‰é…ç½®
- é‡å¯ Docker æœåŠ¡

**ä½¿ç”¨æ–¹æ³•**:
```bash
sudo ./dockers/scripts/setup-docker-mirror.sh
```

**æ•ˆæœ**:
- åŸºç¡€é•œåƒä¸‹è½½é€Ÿåº¦æå‡ 10-30 å€
- node:20.9.0 ä¸‹è½½ä» 10-30 åˆ†é’Ÿé™åˆ° 1-3 åˆ†é’Ÿ

---

### build-optimized.sh
**ç”¨é€”**: ä½¿ç”¨ä¼˜åŒ–çš„ Dockerfile æ„å»ºé•œåƒ

**ç‰¹æ€§**:
- ä½¿ç”¨å›½å†…é•œåƒæºåŠ é€Ÿ
- è‡ªåŠ¨ç¦ç”¨ä»£ç†é¿å…å†²çª
- å¯ç”¨ Docker BuildKit

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /home/baiyx/teable1020
./dockers/scripts/build-optimized.sh
```

**è¾“å‡º**: `teable-community:latest` é•œåƒ

---

### check-build.sh
**ç”¨é€”**: æ£€æŸ¥ Docker æ„å»ºè¿›åº¦å’ŒçŠ¶æ€

**åŠŸèƒ½**:
- æ£€æŸ¥æ„å»ºè¿›ç¨‹æ˜¯å¦è¿è¡Œ
- æ˜¾ç¤ºæœ€æ–°æ„å»ºæ—¥å¿—
- æ£€æŸ¥é•œåƒæ˜¯å¦ç”ŸæˆæˆåŠŸ

**ä½¿ç”¨æ–¹æ³•**:
```bash
./dockers/scripts/check-build.sh
```

---

### monitor-build.sh
**ç”¨é€”**: å®æ—¶ç›‘æ§ Docker æ„å»ºè¿›åº¦

**åŠŸèƒ½**:
- æ¯10ç§’è‡ªåŠ¨åˆ·æ–°æ„å»ºçŠ¶æ€
- æ˜¾ç¤ºå½“å‰æ„å»ºé˜¶æ®µ
- æ˜¾ç¤ºä¸‹è½½/ç¼–è¯‘è¿›åº¦
- è‡ªåŠ¨æ£€æµ‹æ„å»ºå®Œæˆæˆ–å¤±è´¥

**ä½¿ç”¨æ–¹æ³•**:
```bash
./dockers/scripts/monitor-build.sh
```

**æç¤º**: æŒ‰ `Ctrl+C` é€€å‡ºç›‘æ§

---

### push-to-aliyun.sh
**ç”¨é€”**: æ¨é€é•œåƒåˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡

**å‰ç½®æ¡ä»¶**:
1. å·²æœ‰é˜¿é‡Œäº‘è´¦å·
2. å·²åœ¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°:
   - åˆ›å»ºå‘½åç©ºé—´
   - åˆ›å»ºé•œåƒä»“åº“
   - è®¾ç½®é•œåƒæœåŠ¡å¯†ç 

**ä½¿ç”¨æ–¹æ³•**:
```bash
./dockers/scripts/push-to-aliyun.sh
```

è„šæœ¬ä¼šäº¤äº’å¼å¼•å¯¼ä½ å®Œæˆæ¨é€è¿‡ç¨‹ã€‚

---

## ğŸš€ å®Œæ•´å·¥ä½œæµç¨‹

### 0. é…ç½® Docker é•œåƒåŠ é€Ÿå™¨ï¼ˆé¦–æ¬¡å¿…é¡»ï¼‰
```bash
sudo ./dockers/scripts/setup-docker-mirror.sh
```

**é‡è¦**ï¼šè¿™ä¸€æ­¥å¿…é¡»æœ€å…ˆæ‰§è¡Œï¼Œå¦åˆ™æ‹‰å–åŸºç¡€é•œåƒä¼šå¾ˆæ…¢ï¼

### 1. æ„å»ºé•œåƒ
```bash
./dockers/scripts/build-optimized.sh
```

### 2. ç›‘æ§æ„å»ºï¼ˆå¯é€‰ï¼‰
```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£
./dockers/scripts/monitor-build.sh
```

### 3. æ£€æŸ¥æ„å»ºç»“æœ
```bash
./dockers/scripts/check-build.sh
```

### 4. æ¨é€åˆ°é˜¿é‡Œäº‘ï¼ˆå¯é€‰ï¼‰
```bash
./dockers/scripts/push-to-aliyun.sh
```

### 5. å¯åŠ¨æœåŠ¡
```bash
cd dockers/examples/standalone
docker compose up -d
```

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- `/docs/DOCKER_BUILD_GUIDE.md` - Docker æ„å»ºä¼˜åŒ–æŒ‡å—
- `/docs/BUILD_STATUS.md` - æ„å»ºçŠ¶æ€ç›‘æ§æŒ‡å—
- `/dockers/teable/Dockerfile.optimized` - ä¼˜åŒ–çš„ Dockerfile

---

## âš™ï¸ æ„å»ºé…ç½®

### ä¼˜åŒ–é¡¹
- **Debian æº**: æ¸…åå¤§å­¦é•œåƒ
- **NPM æº**: æ·˜å®é•œåƒ
- **ä»£ç†**: è‡ªåŠ¨ç¦ç”¨ï¼ˆé¿å…å†²çªï¼‰
- **ç¼“å­˜**: å¯ç”¨ Docker BuildKit ç¼“å­˜

### æ„å»ºæ—¶é—´
- **é¦–æ¬¡æ„å»º**: 15-25 åˆ†é’Ÿ
- **ä½¿ç”¨ç¼“å­˜**: 3-5 åˆ†é’Ÿ

### é•œåƒå¤§å°
- çº¦ 1.75GB

---

## ğŸ”§ æ•…éšœæ’é™¤

### æ„å»ºå¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -100 build.log

# æ¸…é™¤ç¼“å­˜é‡æ–°æ„å»º
docker builder prune -a
./dockers/scripts/build-optimized.sh
```

### æ¨é€å¤±è´¥
ç¡®ä¿ï¼š
1. é˜¿é‡Œäº‘å‘½åç©ºé—´å·²åˆ›å»º
2. é•œåƒä»“åº“å·²åˆ›å»º
3. é•œåƒæœåŠ¡å¯†ç å·²è®¾ç½®
4. ç½‘ç»œè¿æ¥æ­£å¸¸

è®¿é—®: https://cr.console.aliyun.com/

